name: Set PR Title to Issue Title

on:
  pull_request:
    types: [opened, edited]

jobs:
  update-pr-title:
    runs-on: ubuntu-latest
    steps:
    - name: Check out repository
      uses: actions/checkout@v2

    - name: Get issue title
      id: get_issue_title
      run: |
        ISSUE_NUMBER=$(echo "${{ github.event.pull_request.body }}" | grep -oE "#[0-9]+" | head -n 1 | tr -d '#')
        if [ -z "$ISSUE_NUMBER" ]; then
          echo "No issue number found in PR description."
          exit 1
        fi
        ISSUE_TITLE=$(gh issue view $ISSUE_NUMBER --json title -q .title)
        echo "::set-output name=title::$ISSUE_TITLE"

    - name: Update PR title
      run: |
        gh pr edit ${{ github.event.pull_request.number }} --title "${{ steps.get_issue_title.outputs.title }}"
name: Set PR Title to Issue Title

on:
  pull_request:
    types: [opened, edited]

jobs:
  update-pr-title:
    runs-on: ubuntu-latest  # GitHub Actions는 리눅스 환경에서 실행됨
    steps:
    - name: Check out repository
      uses: actions/checkout@v3

    - name: Install GitHub CLI
      run: sudo apt-get update && sudo apt-get install -y gh

    - name: Authenticate GitHub CLI
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        echo "$GITHUB_TOKEN" | gh auth login --with-token

    - name: Extract issue number from commit message
      id: extract_issue_number
      run: |
        ISSUE_NUMBER=$(git log -1 --pretty=%B | grep -oE "#[0-9]+" | tr -d '#')
        if [ -z "$ISSUE_NUMBER" ]; then
          echo "No issue number found in commit message."
          echo "::set-output name=found::false"
        else
          echo "::set-output name=found::true"
          echo "::set-output name=issue_number::$ISSUE_NUMBER"
        fi

    - name: Fetch issue title
      if: steps.extract_issue_number.outputs.found == 'true'
      id: fetch_issue_title
      run: |
        ISSUE_TITLE=$(gh issue view ${{ steps.extract_issue_number.outputs.issue_number }} --json title -q .title)
        echo "::set-output name=title::$ISSUE_TITLE"

    - name: Update PR title
      if: steps.extract_issue_number.outputs.found == 'true'
      run: |
        gh pr edit ${{ github.event.pull_request.number }} --title "${{ steps.fetch_issue_title.outputs.title }}"
